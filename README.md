# Задание 1. Анализ и планирование

Проект "Smart Home Monolith" представляет собой монолитное приложение для управления отоплением и мониторинга температуры в умном доме. Пользователи
могут удаленно включать/выключать отопление, устанавливать желаемую температуру и просматривать текущую температуру через веб-интерфейс. 
Всё синхронно. Всё управление идёт от сервера к датчику. Данные о температуре также получаются через запрос от сервера к датчику

## Функциональность
**Управление отоплением**
Сервис `HeatingSystemService`
- Пользователи могут включать/выключать отопление;
- Пользователи могут устанавливать желаемую температуру;
- Система автоматически поддерживает температуру.

**Мониторинг температуры**
Сервис `HeatingSystemServiceImpl`
- Пользователи могут просматривать текущую температуру через веб-интерфейс;
- Система получает данные о температуре с датчиков, установленных в домах.

## Архитектура
**Язык программирования:** `Java`
Плюсы:
- Безопасность и надежность;
- Объектно-ориентированный;
- Архитектурная независимость;
- Простота.
Минусы:
- Низкое, в сравнении с другими языками, быстродействие;
- Повышенные требования к объему оперативной памяти.
**База данных:** `PostgreSQL`
Плюсы:
- расширяемость и богатый набор типов данных;
- масштабируемость;
- кросс-платформенность; 
- безопасность; 
- возможности NoSQL; 
- свободное распространение и открытый код; 
- живое сообщество и исчерпывающее официальное руководство.
Минусы:
- Сложности при настройке;
- Повышенное потребление ресурсов;
- Отсутствие некоторых функций.
**Архитектура:** `Монолитная`
Плюсы:
- Простота и скорость разработки;
- Экономия средств;
- Удобное тестирование;
- Простая инфраструктура;
Минусы:
- Сложности с масштабированием;
- Сложности с развитием функционала;
- Низкая устойчивость к сбоям;
- Ограниченное технологическое разнообразие.
**Взаимодействие:** `Синхронное`
Плюсы:
- Проще в реализации и отладке;
- Легко отслеживать и управлять последовательностью выполнения операций.
Минусы:
- Зависимость от доступности;
- Узкое место. Если синхронные вызовы выполняются последовательно, это может стать узким местом производительности.
**Масштабируемость:** Ограничена, так как монолит сложно масштабировать по частям.
**Развёртывание:** Требует остановки всего приложения.

## Домены и границы контекстов
- Домен: Управление Устройствами
    - Поддомен: управление отоплением
        - Контекст: включение\выключение устройства
        - Контекст: установка температуры
    - Поддомен: автоматическое поддержание температуры
      - Контекст: регулировка подачи тепла  
- Домен: Мониторинг температуры
    - Поддомен: получение данных с датчиков
        - Контекст: получение данных о температуре
    - Поддомен: отображение данных
        - Контекст: отображение текущей температуры в доме





# Базовая настройка

## Запуск minikube

[Инструкция по установке](https://minikube.sigs.k8s.io/docs/start/)

```bash
minikube start
```

## Добавление токена авторизации GitHub

[Получение токена](https://github.com/settings/tokens/new)

```bash
kubectl create secret docker-registry ghcr --docker-server=https://ghcr.io --docker-username=<github_username> --docker-password=<github_token> -n default
```

## Установка API GW kusk

[Install Kusk CLI](https://docs.kusk.io/getting-started/install-kusk-cli)

```bash
kusk cluster install
```

## Смена адреса образа в helm chart

После того как вы сделали форк репозитория и у вас в репозитории отработал GitHub Action. Вам нужно получить адрес образа <https://github.com/><github_username>/architecture-sprint-3/pkgs/container/architecture-sprint-3

Он выглядит таким образом
```ghcr.io/<github_username>/architecture-sprint-3:latest```

Замените адрес образа в файле `helm/smart-home-monolith/values.yaml` на полученный файл:

```yaml
image:
  repository: ghcr.io/<github_username>/architecture-sprint-3
  tag: latest
```

## Настройка terraform

[Установите Terraform](https://yandex.cloud/ru/docs/tutorials/infrastructure-management/terraform-quickstart#install-terraform)

Создайте файл ~/.terraformrc

```hcl
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}
```

## Применяем terraform конфигурацию

```bash
cd terraform
terraform init
terraform apply
```

## Настройка API GW

```bash
kusk deploy -i api.yaml
```

## Проверяем работоспособность

```bash
kubectl port-forward svc/kusk-gateway-envoy-fleet -n kusk-system 8080:80
curl localhost:8080/hello
```

## Delete minikube

```bash
minikube delete
```
